<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>날씨 기반 옷 추천</title>
    <link rel="icon" type="image/x-icon" href="img/sun.png" />
    <link rel="stylesheet" href="css/styles.css" />
  </head>
  <body>
    <header>
      <span><img src="img/sun.png" style="height: 40px; width: 40px" /></span>
      <h1>Clothes Recommendation</h1>
    </header>
    <main>
      <div class="weather-box">
        <div class="weather-icon__box">
          <img src="img/ellipsis-solid.svg" id="weather-icon" />
        </div>
        <div class="weather-info">
          <span id="city"></span>
          <span id="weather-temp"><span> - </span>°C</span>
          <span id="weather-condition"></span>
        </div>
        <div id="weather-more">
          <p>Please authorize location access</p>
        </div>
      </div>
      <div class="clothes-box">
        <p id="clothes-info"></p>
        <div class="clothes-box__tops">
          <div id="clothes_item-1">
            <img src="img/shirt-solid.svg" alt="" />
            <span>1</span>
          </div>
          <div id="clothes_item-2">
            <img src="img/shirt-solid.svg" alt="" />
            <span>2</span>
          </div>
          <div id="clothes_item-3">
            <img src="img/shirt-solid.svg" alt="" />
            <span>3</span>
          </div>
        </div>
        <div class="clothes-box__bottoms">
          <div id="clothes_item-4">
            <img src="img/pants.png" alt="" />
            <span>1</span>
          </div>
          <div id="clothes_item-5">
            <img src="img/pants.png" alt="" />
            <span>2</span>
          </div>
          <div id="clothes_item-6">
            <img src="img/pants.png" alt="" />
            <span>3</span>
          </div>
        </div>
        <div class="clothes-box__footwears">
          <div id="clothes_item-7">
            <img src="img/socks-solid.svg" alt="" />
            <span>1</span>
          </div>
          <div id="clothes_item-8">
            <img src="img/socks-solid.svg" alt="" />
            <span>2</span>
          </div>
          <div id="clothes_item-9">
            <img src="img/socks-solid.svg" alt="" />
            <span>3</span>
          </div>
        </div>
        <div class="clothes-box__accessories">
          <div>
            <img src="img/glasses-solid.svg" alt="" />
            <span>1</span>
          </div>
          <div>
            <img src="img/glasses-solid.svg" alt="" />
            <span>2</span>
          </div>
          <div>
            <img src="img/glasses-solid.svg" alt="" />
            <span>3</span>
          </div>
        </div>
      </div>
    </main>
    <!-- <footer>yoursin, 2023</footer> -->
    <script
      src="https://kit.fontawesome.com/39e2faebad.js"
      crossorigin="anonymous"
    ></script>
    <script src="js/weather.js"></script>
    <script
      src="https://code.jquery.com/jquery-3.5.1.js"
      integrity="sha256-QWo7LDvxbWT2tbbQ97B53yJnYU3WhH/C8ycbRAkjPDc="
      crossorigin="anonymous"
    ></script>

    <script>
      window.addEventListener("storage", function (e) {});
      $(window).on("storage", function (e) {
        alert("성공의맛 tv!!!!!!!!!!!");
        getStoredCloset();
        // else, event is caused by an update to localStorage, ignore it
      });
      //화면에 텍스트, 이미지 출력함
      function printCloset(closet) {
        const printCloset = (closet) => {
          for (let i = 0; i < 9; i++) {
            document.querySelector(
              `#clothes_item-${i + 1} span`
            ).innerText = `${closet[Math.floor(i / 3)][i % 3].text}`;
            document
              .querySelector(`#clothes_item-${i + 1} img`)
              .setAttribute("src", `${closet[Math.floor(i / 3)][i % 3]}`.img);
          }
        };
      }

      //sessionStorage에 저장된 값을 가져옴
      function getStoredCloset() {
        const closet = JSON.parse(sessionStorage.getItem("storedCloset"));
        for (let i = 0; i < 3; i++) {
          for (let j = 0; j < 3; j++) {
            closet[i][j].img = kakaoApiGetImg(i + j + 1, closet[i][j].text);
          }
        }
        printCloset(closet);
      }

      //검색어를 받고, 해당하는 이미지를 검색해 이미지의 주소를 return함
      function kakaoApiGetImg(searchName) {
        //https://developers.kakao.com/tool/rest-api/open/get/v2-search-image

        $.ajax({
          type: "GET",

          url: "https://dapi.kakao.com/v2/search/image",

          headers: {
            Authorization: "KakaoAK 165585191c1a927d27cbfcbaeb891ce6",
          },

          data: {
            query: searchName,

            sort: "accuracy", //accuracy(정확도순) 또는 recency(최신순)

            page: 1, //결과 페이지 번호, 1~50 사이의 값, 기본 값 1

            size: 1, //한 페이지에 보여질 문서 수, 1~80 사이의 값, 기본 값 80
          },

          success: function (jdata) {
            console.log(jdata);
            return jdata.documents[0].image_url;
          },

          error: function (xhr, textStatus) {
            console.log(xhr.responseText);

            console.log("실패의맛tv");

            return "";
          },
        });
      }
    </script>
  </body>
</html>
